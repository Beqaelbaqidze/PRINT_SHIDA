<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .tabs button {
      padding: 10px;
      margin-right: 5px;
      border: none;
      background: #ddd;
      cursor: pointer;
    }
    .tabs button.active { background: #4285f4; color: white; }
    .tab-content { display: none; margin-top: 20px; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; }
    th { background: #f2f2f2; }
  </style>
</head>
<body>

<h1>📊 License Admin Dashboard</h1>

<div class="tabs">
  <button onclick="openTab('companies')" class="active">Companies</button>
  <button onclick="openTab('operators')">Operators</button>
  <button onclick="openTab('computers')">Computers</button>
  <button onclick="openTab('softwares')">Softwares</button>
  <button onclick="openTab('licenses')">Licenses</button>
</div>

<div id="companies" class="tab-content active"><h2>Companies</h2><table id="companies-table"></table></div>
<div id="operators" class="tab-content"><h2>Operators</h2><table id="operators-table"></table></div>
<div id="computers" class="tab-content"><h2>Computers</h2><table id="computers-table"></table></div>
<div id="softwares" class="tab-content"><h2>Softwares</h2><table id="softwares-table"></table></div>
<div id="licenses" class="tab-content"><h2>Licenses</h2><table id="licenses-table"></table></div>

<script>
function openTab(tabName) {
  document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
  document.querySelectorAll(".tabs button").forEach(btn => btn.classList.remove("active"));
  document.getElementById(tabName).classList.add("active");
  document.querySelector(`.tabs button[onclick*="${tabName}"]`).classList.add("active");
}

function loadTable(endpoint, tableId) {
  fetch(endpoint)
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById(tableId);
      if (data.length === 0) {
        table.innerHTML = "<tr><td>No data</td></tr>";
        return;
      }
      const keys = Object.keys(data[0]);
      table.innerHTML = `
        <tr>${keys.map(k => `<th>${k}</th>`).join('')}<th>Actions</th></tr>
        ${data.map(row => `
          <tr>
            ${keys.map(k => `<td>${row[k]}</td>`).join('')}
            <td>
              <button onclick="alert('Edit ${row[keys[0]]}')">✏️</button>
              <button onclick="deleteRow('${endpoint}', ${row[keys[0]]}, '${tableId}', '${keys[0]}')">🗑️</button>
            </td>
          </tr>
        `).join('')}
      `;
    });
}

function deleteRow(endpoint, id, tableId, idField) {
  const api = `${endpoint}/${id}`;
  if (confirm(`Delete record ${id}?`)) {
    fetch(api, { method: "DELETE" })
      .then(res => res.json())
      .then(() => loadTable(endpoint, tableId));
  }
}

loadTable("/companies", "companies-table");
loadTable("/operators", "operators-table");
loadTable("/computers", "computers-table");
loadTable("/softwares", "softwares-table");
loadTable("/licenses/full", "licenses-table");
</script>

</body>
</html>
